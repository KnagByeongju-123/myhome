<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ì˜ ì—¬í–‰ ë¸”ë¡œê·¸</title>
    <style>
        :root { --primary: #3b82f6; --bg: #f8f9fa; --text: #333; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Noto Sans KR', sans-serif; background: var(--bg); color: var(--text); padding-top: 60px; }
        
        /* í—¤ë” */
        header { position: fixed; top: 0; width: 100%; height: 60px; background: white; border-bottom: 1px solid #ddd; z-index: 100; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .nav { display: flex; gap: 20px; }
        .nav a { text-decoration: none; color: #666; font-weight: bold; padding: 8px 12px; border-radius: 5px; cursor: pointer; transition: 0.3s; }
        .nav a:hover, .nav a.active { color: var(--primary); background: #eff6ff; }
        
        /* ì»¨í…ì¸  ì˜ì—­ */
        .container { max-width: 1000px; margin: 0 auto; padding: 40px 20px; min-height: 80vh; }
        .section { display: none; animation: fadeIn 0.3s; }
        .section.show { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        h2 { margin-bottom: 20px; border-bottom: 2px solid var(--primary); display: inline-block; padding-bottom: 5px; }
        .controls { display: flex; justify-content: space-between; margin-bottom: 20px; align-items: center; }
        .btn { background: var(--primary); color: white; border: none; padding: 8px 16px; border-radius: 5px; cursor: pointer; font-size: 0.9rem; }
        .btn:hover { opacity: 0.9; }

        /* [ê²Œì‹œíŒ ìŠ¤íƒ€ì¼] */
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #f1f5f9; font-weight: 600; }
        tr:hover { background: #f8fafc; }

        /* [ë¸”ë¡œê·¸/ê°¤ëŸ¬ë¦¬ ì¹´ë“œ ìŠ¤íƒ€ì¼] - í•µì‹¬ ë³€ê²½ */
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }
        .blog-card { 
            background: white; border-radius: 12px; overflow: hidden; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.08); transition: 0.3s; cursor: pointer;
            display: flex; flex-direction: column;
        }
        .blog-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.15); }
        .card-img { height: 200px; background: #eee; overflow: hidden; }
        .card-img img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
        .blog-card:hover .card-img img { transform: scale(1.05); }
        .card-body { padding: 20px; flex: 1; display: flex; flex-direction: column; }
        .card-title { font-size: 1.1rem; font-weight: bold; margin-bottom: 10px; color: #1f2937; }
        .card-desc { 
            font-size: 0.9rem; color: #666; line-height: 1.5; margin-bottom: 15px; 
            display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; /* 3ì¤„ ë§ì¤„ì„ */
        }
        .card-date { margin-top: auto; font-size: 0.8rem; color: #999; text-align: right; }

        /* ëª¨ë‹¬ (íŒì—…) */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal.open { display: flex; }
        .modal-box { background: white; width: 90%; max-width: 600px; padding: 25px; border-radius: 10px; max-height: 90vh; overflow-y: auto; position: relative; }
        .close-btn { position: absolute; top: 15px; right: 20px; font-size: 24px; cursor: pointer; background: none; border: none; }
        
        .form-group { margin-bottom: 15px; }
        .form-label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem; }
        .form-input, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        textarea { height: 100px; resize: vertical; }

        /* ìƒì„¸ ë³´ê¸° ëª¨ë‹¬ ë‚´ìš© */
        .view-content img { max-width: 100%; border-radius: 8px; margin-bottom: 20px; }
        .view-text { line-height: 1.6; white-space: pre-wrap; }
    </style>
</head>
<body>
    <header>
        <nav class="nav">
            <a onclick="showSection('home')" class="active">ğŸ  í™ˆ</a>
            <a onclick="showSection('board')">ğŸ“ ê²Œì‹œíŒ</a>
            <a onclick="showSection('gallery')">âœˆï¸ ì—¬í–‰ ë¸”ë¡œê·¸</a>
        </nav>
    </header>

    <div class="container">
        <section id="home" class="section show">
            <h2>í™˜ì˜í•©ë‹ˆë‹¤!</h2>
            <p>ë‚˜ì˜ ì—¬í–‰ ê¸°ë¡ê³¼ ììœ  ê²Œì‹œíŒì´ ìˆëŠ” ê³µê°„ì…ë‹ˆë‹¤.</p>
            <div style="margin-top: 20px; padding: 15px; background: white; border-radius: 8px;">
                <p id="status-msg">ğŸ“¡ ë°ì´í„° ì—°ê²° ëŒ€ê¸° ì¤‘...</p>
            </div>
        </section>

        <section id="board" class="section">
            <div class="controls">
                <h2>ììœ  ê²Œì‹œíŒ</h2>
                <button class="btn" onclick="openModal('modal-write')">ê¸€ì“°ê¸°</button>
            </div>
            <table>
                <thead><tr><th width="50">No</th><th>ì œëª©</th><th width="80">ì‘ì„±ì</th><th width="100">ë‚ ì§œ</th></tr></thead>
                <tbody id="board-list"><tr><td colspan="4">ë¡œë”© ì¤‘...</td></tr></tbody>
            </table>
        </section>

        <section id="gallery" class="section">
            <div class="controls">
                <h2>ë‚˜ì˜ ì—¬í–‰ ê¸°ë¡</h2>
                <button class="btn" onclick="openModal('modal-upload')">ğŸ“¸ ì—¬í–‰ ê¸°ë¡í•˜ê¸°</button>
            </div>
            <div id="gallery-list" class="gallery-grid">
                <p>ë¡œë”© ì¤‘...</p>
            </div>
        </section>
    </div>

    <div id="modal-write" class="modal">
        <div class="modal-box">
            <button class="close-btn" onclick="closeModal('modal-write')">&times;</button>
            <h3>ìƒˆ ê¸€ ì‘ì„±</h3><br>
            <input id="w-author" class="form-input" placeholder="ì‘ì„±ì" style="margin-bottom:10px;">
            <input id="w-title" class="form-input" placeholder="ì œëª©" style="margin-bottom:10px;">
            <textarea id="w-content" placeholder="ë‚´ìš©"></textarea><br><br>
            <button class="btn" onclick="savePost()" style="width:100%">ë“±ë¡</button>
        </div>
    </div>

    <div id="modal-upload" class="modal">
        <div class="modal-box">
            <button class="close-btn" onclick="closeModal('modal-upload')">&times;</button>
            <h3>ì—¬í–‰ ê¸°ë¡ ë‚¨ê¸°ê¸°</h3><br>
            <div class="form-group">
                <label class="form-label">ë¹„ë°€ë²ˆí˜¸ (8877)</label>
                <input type="password" id="u-pw" class="form-input">
            </div>
            <div class="form-group">
                <label class="form-label">ì œëª© (ì—¬í–‰ì§€)</label>
                <input type="text" id="u-title" class="form-input" placeholder="ì˜ˆ: 2024 íŒŒë¦¬ ì—¬í–‰">
            </div>
            <div class="form-group">
                <label class="form-label">ë‚´ìš© (ì„¤ëª…)</label>
                <textarea id="u-desc" placeholder="ì—¬í–‰ ì´ì•¼ê¸°ë¥¼ ì ì–´ì£¼ì„¸ìš”."></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">ì‚¬ì§„ ì„ íƒ</label>
                <input type="file" id="u-file" class="form-input" accept="image/*">
            </div>
            <button class="btn" id="btn-upload" onclick="uploadImage()" style="width:100%">ê¸°ë¡ ì €ì¥</button>
        </div>
    </div>

    <div id="modal-view" class="modal">
        <div class="modal-box">
            <button class="close-btn" onclick="closeModal('modal-view')">&times;</button>
            <h3 id="v-title" style="border-bottom:1px solid #eee; padding-bottom:10px; margin-bottom:15px;">ì œëª©</h3>
            <div id="v-meta" style="color:#888; font-size:0.9rem; margin-bottom:20px;">ì •ë³´</div>
            <div id="v-content" class="view-content view-text">ë‚´ìš©</div>
        </div>
    </div>

    <script>
        // â˜…â˜…â˜… ë°°í¬ í›„ ìƒì„±ëœ URLì„ ì—¬ê¸°ì— ë„£ìœ¼ì„¸ìš” â˜…â˜…â˜…
        const API_URL = "https://script.google.com/macros/s/AKfycbyOjYEtAlCm8drpFjoIfNanRaJfHWdWkS3nQHmXLXGVQivqaNWz776NqfpVB4B4jGlH9A/exec"; 

        let postsData = [];
        let galleryData = [];

        window.onload = function() {
            loadAllData();
        };

        // 1. í™”ë©´ ì „í™˜
        function showSection(id) {
            document.querySelectorAll('.section').forEach(el => el.classList.remove('show'));
            document.getElementById(id).classList.add('show');
            document.querySelectorAll('.nav a').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
        }

        // 2. ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadAllData() {
            try {
                // ê²Œì‹œê¸€ ë¡œë“œ
                const postRes = await fetch(API_URL + "?action=getPosts");
                postsData = await postRes.json();
                renderBoard();

                // ê°¤ëŸ¬ë¦¬ ë¡œë“œ
                const imgRes = await fetch(API_URL + "?action=getImages");
                galleryData = await imgRes.json();
                renderGallery();

                document.getElementById('status-msg').innerHTML = `<span style="color:green">âœ… ë°ì´í„° ë¡œë“œ ì™„ë£Œ! (ê²Œì‹œê¸€: ${postsData.length}, ì‚¬ì§„: ${galleryData.length})</span>`;
            } catch (e) {
                document.getElementById('status-msg').innerHTML = `<span style="color:red">âŒ ì—°ê²° ì‹¤íŒ¨. API ì£¼ì†Œë¥¼ í™•ì¸í•˜ì„¸ìš”.</span>`;
            }
        }

        // 3. ê²Œì‹œíŒ ë Œë”ë§
        function renderBoard() {
            const tbody = document.getElementById('board-list');
            tbody.innerHTML = "";
            postsData.forEach(p => {
                tbody.innerHTML += `
                    <tr onclick="viewDetail('post', ${p.no})" style="cursor:pointer">
                        <td>${p.no}</td>
                        <td>${p.title}</td>
                        <td>${p.author}</td>
                        <td>${p.date}</td>
                    </tr>`;
            });
        }

        // 4. ê°¤ëŸ¬ë¦¬(ë¸”ë¡œê·¸) ë Œë”ë§
        function renderGallery() {
            const container = document.getElementById('gallery-list');
            container.innerHTML = "";
            galleryData.forEach((item, idx) => {
                let dateStr = new Date(item.date).toLocaleDateString();
                container.innerHTML += `
                    <div class="blog-card" onclick="viewDetail('gallery', ${idx})">
                        <div class="card-img"><img src="${item.url}" loading="lazy"></div>
                        <div class="card-body">
                            <div class="card-title">${item.title}</div>
                            <div class="card-desc">${item.description || "ë‚´ìš© ì—†ìŒ"}</div>
                            <div class="card-date">${dateStr}</div>
                        </div>
                    </div>`;
            });
        }

        // 5. ìƒì„¸ ë³´ê¸°
        function viewDetail(type, id) {
            const title = document.getElementById('v-title');
            const meta = document.getElementById('v-meta');
            const content = document.getElementById('v-content');

            if (type === 'post') {
                const p = postsData.find(x => x.no == id);
                title.innerText = p.title;
                meta.innerText = `ì‘ì„±ì: ${p.author} | ë‚ ì§œ: ${p.date}`;
                content.innerHTML = `<div class="view-text">${p.content}</div>`;
            } else {
                const g = galleryData[id];
                title.innerText = g.title;
                meta.innerText = new Date(g.date).toLocaleDateString();
                // ì´ë¯¸ì§€ + ì„¤ëª… ì¶œë ¥
                content.innerHTML = `
                    <img src="${g.url}">
                    <div class="view-text">${g.description}</div>
                `;
            }
            openModal('modal-view');
        }

        // 6. ê¸€ì“°ê¸° / ì—…ë¡œë“œ ê¸°ëŠ¥
        async function savePost() {
            const data = {
                action: 'savePost',
                author: document.getElementById('w-author').value,
                title: document.getElementById('w-title').value,
                content: document.getElementById('w-content').value
            };
            await sendData(data, 'modal-write');
        }

        async function uploadImage() {
            if (document.getElementById('u-pw').value !== '8877') return alert('ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜');
            const fileInput = document.getElementById('u-file');
            if (!fileInput.files.length) return alert('íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”');

            const btn = document.getElementById('btn-upload');
            btn.innerText = "ì—…ë¡œë“œ ì¤‘..."; btn.disabled = true;

            const file = fileInput.files[0];
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = async function(e) {
                const data = {
                    action: 'uploadImage',
                    fileName: (document.getElementById('u-title').value || file.name),
                    description: document.getElementById('u-desc').value,
                    mimeType: file.type,
                    fileData: e.target.result
                };
                await sendData(data, 'modal-upload');
                btn.innerText = "ê¸°ë¡ ì €ì¥"; btn.disabled = false;
            };
        }

        async function sendData(data, modalId) {
            try {
                await fetch(API_URL, { method: 'POST', body: JSON.stringify(data) });
                alert('ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
                closeModal(modalId);
                loadAllData(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            } catch (e) {
                alert('ì˜¤ë¥˜ ë°œìƒ: ' + e);
            }
        }

        // ëª¨ë‹¬ ì œì–´
        function openModal(id) { document.getElementById(id).classList.add('open'); }
        function closeModal(id) { document.getElementById(id).classList.remove('open'); }
    </script>
</body>
</html>
